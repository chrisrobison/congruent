<!DOCTYPE html>
<html>
<head>
   <style>
      body { background-color:#000; }
   </style>
</head>
<body>
   <canvas id="canvas" width="70" height="70"></canvas>

<script>
(function() {
   window.cdr = {
      particle: {
         velocity :null,
         position : null,

         /// dummy constructor
         create : function(x,y,speed,angle) {
            console.log(x,y,speed,angle)
            var obj=Object.create(this);
            obj.velocity = cdr.vector.create(0,0);
            
            obj.velocity.setLength(speed);
            obj.velocity.setAngle(angle);
            obj.position = cdr.vector.create(x,y);
            console.log("object")
            console.log(obj);
            return obj;
         },

         update: function(){
            this.position.addTo(this.velocity);
         }

      },
      vector: {
         _x:0,
         _y:0,

         // dummy constructor
         create : function(x,y){var obj= Object.create(this);obj._y=y; obj._x=x; return obj;},

         // member functions
         getX : function(){ return this._x},
         getY : function(){ return this._y},
         setX : function(value){  this._x=value;},
         setY : function(value){  this._y=value;},
         getLength : function(){ return Math.sqrt(this._x*this._x + this._y*this._y)},
         getAngle : function(){ return Math.atan2(this._y,this._x) },
         setAngle : function(angle){ length=this.getLength(); this._y =Math.cos(angle)*length; this._x= Math.sin(angle)*length; },
         setLength: function(length){ angle=this.getAngle(); this._y=Math.cos(angle)*length; this._x=Math.sin(angle)*length; },
         add : function(v2){     vect = this.create(this._x+v2._x, this._y+v2._y);  return vect;    },
         subtract : function(v2){   vect = this.create(this._x-v2._x, this._y-v2._y);  return vect;    },
         multiply: function(value){ return vector.create(this._x*value,this._y*value)},
         divide: function(value){ return vector.create(this._x/value,this._y/value)},
         scale: function(value){ this._x=this._x*value; this._y=this._y*value;},
         addTo: function(v2){ this._x=this._x+v2._x; this._y=this._y+v2._y },
         subtractFrom: function(v2){ this._x=this._x-v2._x; this._y=this._y-v2._y }
      },

      initParticles: function(){
         cdr.canvas=document.getElementById("canvas");
         cdr.canvas.addEventListener("click", function(event) {
            cdr.explode(event.clientX, event.clientY);
         });
         cdr.context=canvas.getContext("2d");
         cdr.width=canvas.width=window.innerWidth;
         cdr.height=canvas.height=window.innerHeight;
         cdr.particles=[];
         cdr.numparticles=100;
         cdr.duration=300;
         cdr.radius = 2.5;
         /*
         for(i=0;i<numparticles;i++) {
            particles.push(particle.create(width/2,height/2,(Math.random()*10)+1,Math.random()*Math.PI*2))
         }
         
         update();
         */
      },
      
      explode: function(x, y) {
         cdr.particles=[];
         for(i=0;i<cdr.numparticles;i++) {
            cdr.particles.push(cdr.particle.create(x,y,(Math.random()*10)+1,Math.random()*Math.PI*2))
         }
         cdr.started = Date.now();
         cdr.step = 1 / cdr.duration;
         cdr.alpha = 1;
         cdr.size = cdr.radius;
         cdr.sstep = cdr.radius / cdr.duration;
         cdr.colors = {red: 255, green: 255, blue: 255};

         cdr.update();
      },

      update: function(){
         cdr.context.clearRect(0, 0, cdr.width, cdr.height);
         var ddiff = Date.now() - cdr.started;
         cdr.alpha = 1 - (ddiff * cdr.step);
         cdr.size = (cdr.radius + 0.1) - (ddiff * cdr.sstep);
         if (cdr.size < 0) {
            cdr.size = 0.01;
         }
         var colors = [`rgba(255, 0, 0, ${cdr.alpha})`, `rgba(255, 255, 0, ${cdr.alpha})`, `rgba(0, 255, 0, ${cdr.alpha})`, `rgba(0, 150, 255, ${cdr.alpha})`, `rgba(255, 0, 255, ${cdr.alpha})`];
         for (var i = 0; i < cdr.numparticles; i++) {
            cdr.particles[i].update();
            cdr.context.beginPath();
            cdr.context.fillStyle = colors[4];
            cdr.context.arc(cdr.particles[i].position.getX(), cdr.particles[i].position.getY(), cdr.size, 0, 2*Math.PI, false);
            cdr.context.fill();
         }
         
         if (ddiff < cdr.duration) {
            requestAnimationFrame(cdr.update);
         }
      }
   };
   cdr.initParticles();
})();
</script>
 </body>
</html>
